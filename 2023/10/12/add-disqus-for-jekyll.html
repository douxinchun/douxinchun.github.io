<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>在 Jekyll 中添加 Disqus | Spring Notes</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="在 Jekyll 中添加 Disqus" />
<meta name="author" content="Spring" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Jekyll 目录结构的变化 如果使用 Jekyll disqus 或 Octorpess 作为关键字 google, 得到的结果多数是先引导你在 _includes/* 文件夹下添加一个 disqusXXX.html文件. 然后当我们浏览 Jekyll 根目录的事后, 却发现找不到 _include 文件夹…" />
<meta property="og:description" content="Jekyll 目录结构的变化 如果使用 Jekyll disqus 或 Octorpess 作为关键字 google, 得到的结果多数是先引导你在 _includes/* 文件夹下添加一个 disqusXXX.html文件. 然后当我们浏览 Jekyll 根目录的事后, 却发现找不到 _include 文件夹…" />
<link rel="canonical" href="https://douxinchun.github.io/2023/10/12/add-disqus-for-jekyll.html" />
<meta property="og:url" content="https://douxinchun.github.io/2023/10/12/add-disqus-for-jekyll.html" />
<meta property="og:site_name" content="Spring Notes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-10-12T22:20:42+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="在 Jekyll 中添加 Disqus" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Spring"},"dateModified":"2023-10-12T22:20:42+08:00","datePublished":"2023-10-12T22:20:42+08:00","description":"Jekyll 目录结构的变化 如果使用 Jekyll disqus 或 Octorpess 作为关键字 google, 得到的结果多数是先引导你在 _includes/* 文件夹下添加一个 disqusXXX.html文件. 然后当我们浏览 Jekyll 根目录的事后, 却发现找不到 _include 文件夹…","headline":"在 Jekyll 中添加 Disqus","mainEntityOfPage":{"@type":"WebPage","@id":"https://douxinchun.github.io/2023/10/12/add-disqus-for-jekyll.html"},"url":"https://douxinchun.github.io/2023/10/12/add-disqus-for-jekyll.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://douxinchun.github.io/feed.xml" title="Spring Notes" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Spring Notes</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">在 Jekyll 中添加 Disqus</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2023-10-12T22:20:42+08:00" itemprop="datePublished">Oct 12, 2023
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="jekyll-目录结构的变化">Jekyll 目录结构的变化</h1>
<p>如果使用 Jekyll disqus 或 Octorpess 作为关键字 google, 得到的结果多数是先引导你在 <code class="language-plaintext highlighter-rouge">_includes/*</code> 文件夹下添加一个 <code class="language-plaintext highlighter-rouge">disqusXXX.html</code>文件. 然后当我们浏览 Jekyll 根目录的事后, 却发现找不到 <code class="language-plaintext highlighter-rouge">_include</code> 文件夹…</p>

<p>这是因为从 Jekyll 使用 gem 来管理主题后, 项目目录结构就发生了一些变动.</p>

<p>Jekyll 3.2 以前(不支持 gem theme 的版本)的项目目录结构.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
├── _config.yml
├── _data
│   └── members.yml
├── _drafts
│   ├── begin-with-the-crazy-ideas.md
│   └── on-simplicity-in-technology.md
├── _includes
│   ├── footer.html
│   └── header.html
├── _layouts
│   ├── default.html
│   └── post.html
├── _posts
│   ├── 2007-10-29-your-posts.md
├── _sass
│   ├── _base.scss
│   └── _layout.scss
├── _site
├── .jekyll-cache
│   └── Jekyll
│       └── Cache
│           └── [...]
├── .jekyll-metadata
└── index.html # can also be an 'index.md' with valid front matter
</code></pre></div></div>
<p>Jekyll 3.2 以后,因为 Jekyll theme 采用 gem 来管理, 所以 <code class="language-plaintext highlighter-rouge">_includes</code>, <code class="language-plaintext highlighter-rouge">_layouts</code> 以及 <code class="language-plaintext highlighter-rouge">_sass</code>等文件夹,都被移到了 gem theme 的项目文件夹中.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  Blog git:(main) ✗ bundle info minima
  * minima (2.5.1)
	Summary: A beautiful, minimal theme for Jekyll.
	Homepage: https://github.com/jekyll/minima
	Path: /Users/&lt;username&gt;/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/minima-2.5.1
	Reverse Dependencies:
		github-pages (228) depends on minima (= 2.5.1)
</code></pre></div></div>
<p>根据 Path, 查看 minima 的项目文件, 可以看到 _include 文件夹中已经有添加好的 disqus_comments.html(说明该 minima 主题默认支持 disqus)</p>

<p><img src="/images/minima-disqus.png" alt="minima theme folder" /></p>

<p>Jekyll docs 中关于这一变化的说明: <a href="https://jekyllrb.com/docs/structure/">https://jekyllrb.com/docs/structure/</a></p>

<h1 id="添加-disqus-的流程">添加 Disqus 的流程</h1>
<ol>
  <li>去 <a href="https://disqus.com/">Disqus</a> 注册账号, 创建一个 site, 并获取 short_name</li>
  <li>在 <code class="language-plaintext highlighter-rouge">_config.yml</code> 中配置 disqus 的 short_name, 配置 url
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>url: "https://douxinchun.github.io"
...
# Disqus Comments
disqus:
  shortname: springs-blog
</code></pre></div>    </div>
  </li>
  <li>在 markdown 文件中启用 comments
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
...
comments: true
---
</code></pre></div>    </div>
  </li>
</ol>

<h1 id="注意事项">注意事项</h1>
<h2 id="1jekyll-environment-问题">1.Jekyll environment 问题</h2>
<p>在上的图中可以以看到 disqus comments 需要在 production 环境下启用.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- if page.comments != false and jekyll.environment == "production" -
</code></pre></div></div>

<p>更多关于 Jekyll environment 的介绍, 可以查看这里<a href="https://jekyllrb.com/docs/configuration/environments/">https://jekyllrb.com/docs/configuration/environments/</a></p>

<p>根据之前的文章 “Octopress 2.0 到 3.0 的迁移”中”部署”章节中的介绍, 我把博客文章的管理和部署分开在两个不同的仓库, 所以这里需要在部署到 github pages 服务之前, build 的时候把环境变量 <code class="language-plaintext highlighter-rouge">JEKYLL_ENV</code> 设置为 <code class="language-plaintext highlighter-rouge">production</code>, 部署结束后,在设置为原值,这样可以保留本地在<code class="language-plaintext highlighter-rouge">development</code>环境下部署, 服务器在<code class="language-plaintext highlighter-rouge">production</code>环境下部署.<br />
我写了一个简单的脚本<code class="language-plaintext highlighter-rouge">deploy.sh</code>,来事项上述操作:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/zsh</span>
<span class="nv">Original_JEKYLL_ENV</span><span class="o">=</span><span class="nv">$JEKYLL_ENV</span>
<span class="nb">export </span><span class="nv">JEKYLL_ENV</span><span class="o">=</span>production
bundle <span class="nb">exec </span>jekyll build
octopress deploy
<span class="nb">export </span><span class="nv">JEKYLL_ENV</span><span class="o">=</span><span class="nv">$Original_JEKYLL_ENV</span>

</code></pre></div></div>

<h2 id="2-文章的链接问题">2. 文章的链接问题</h2>
<p>默认的文件链接路径中带有了 category, 由于该链接会被 disqus 作为文章评论的 key 被使用, 所以需要保持稳定性.</p>

<p>在 <code class="language-plaintext highlighter-rouge">_config.yml</code> 中配置 permalink 的样式:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>permalink: /:year/:month/:day/:title:output_ext
</code></pre></div></div>
<p>更多选项,请参照<a href="http://jekyllrb.com/docs/permalinks/">http://jekyllrb.com/docs/permalinks/</a></p>

  </div><div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://douxinchun.github.io/2023/10/12/add-disqus-for-jekyll.html';
      this.page.identifier = 'https://douxinchun.github.io/2023/10/12/add-disqus-for-jekyll.html';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://springs-blog.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><a class="u-url" href="/2023/10/12/add-disqus-for-jekyll.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Spring Notes</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Spring</li><li><a class="u-email" href="mailto:douxinchun@gmail.com">douxinchun@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/douxinchun"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">douxinchun</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Dying is the day worth living for</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
